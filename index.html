<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Test AWS Lambda</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    
    <h1>My Simple Inventory App <button class="load-style" id="load-data">Load All Items</button></h1>

    <!-- Table created with help from ChatGPT -->
    <table>
        <thead>
            <tr>
                <th scope="col">Id</th>
                <th scope="col">Name</th>
                <th scope="col">Price</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody id="lambda-info">
            <!-- Filled in dynamically -->
        </tbody>
    </table>

    <hr>

    <!-- Original table, but it wasn't working -->
    <!-- <table class="add-data">
        <thead>
            <tr>
                <th class="second-th" colspan="2">Add New Item to Database</th>
            </tr>

            <tr>
                <td>
                    <label for="put-id">ID:</label>
                    <input type="text" id="put-id" placeholder="Enter ID">
                </td>
            </tr>

            <tr>
                <td>
                    <label for="put-name">Name:</label>
                    <input type="text" id="put-name" placeholder="Enter name">
                </td>
            </tr>

            <tr>
                <td>
                    <label for="put-price">Price:</label>
                    <input type="number" id="put-price" placeholder="Enter price">
                </td>
            </tr>
        </thead>
    </table> -->

    <!-- Replaced not-working table above with code from ChatGPT -->
    <div class="add-container">
        <h2>Add New Item to Database</h2>
        <form class="add-form" id="add-form">
            <div class="form-row">
            <label for="put-id">ID:</label>
            <input type="text" id="put-id" placeholder="Placeholder">
            </div>

            <div class="form-row">
            <label for="put-name">Name:</label>
            <input type="text" id="put-name" placeholder="Placeholder">
            </div>

            <div class="form-row">
            <label for="put-price">Price:</label>
            <input type="number" id="put-price" placeholder="Placeholder">
            </div>

            <button class="add-item" type="button" id="send-data">Add Item</button>
        </form>
    </div>

    <!-- PUT Request -->
    <!-- Written with help from ChatGPT -->
    <script>
            document.getElementById("send-data").addEventListener("click", function () {
                const id = document.getElementById("put-id").value.trim();
                const name = document.getElementById("put-name").value.trim();
                const price = parseFloat(document.getElementById("put-price").value);

                if (!id || !name || isNaN(price)) {
                    alert("Please enter valid ID, name, and price.");
                    return;
                }

                const xhr = new XMLHttpRequest();
                xhr.open("PUT", "https://jdaz69h8pb.execute-api.us-east-2.amazonaws.com/items");
                xhr.setRequestHeader("Content-Type", "application/json");

                const data = { id: id, name: name, price: price};
                xhr.send(JSON.stringify(data));

                xhr.onload = function () {
                    if (xhr.status === 200) {
                        alert("Item added or updated successfully!");
                    } else {
                        alert("Error: " + xhr.statusText);
                    }
                };
            });
    </script>

    <!-- GET Request -->
    <!-- Written with help from ChatGPT -->
    <script>
        document.getElementById("load-data").onclick = function() {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "https://jdaz69h8pb.execute-api.us-east-2.amazonaws.com/items");

            xhr.onload = function() {
                if (xhr.status === 200) {
                const data = JSON.parse(xhr.responseText);
                const tbody = document.getElementById("lambda-info");
                tbody.innerHTML = ""; // clear previous table contents

                // Sort items by ID (assuming numeric IDs; if string, this still works lexically)
                data.sort((a, b) => {
                    // If IDs are numbers
                    if (!isNaN(a.id) && !isNaN(b.id)) return a.id - b.id;
                    // Otherwise, compare as strings
                    return a.id.toString().localeCompare(b.id.toString());
                });

                // Add sorted rows
                data.forEach(item => addRowToTable(item));

                } else {
                alert("Failed to load items.");
                }
            };

            xhr.send();

            };

            // Helper function to add a row dynamically
            function addRowToTable(item) {
                const tbody = document.getElementById("lambda-info");
                const tr = document.createElement("tr");

                const tdId = document.createElement("td");
                tdId.textContent = item.id;

                const tdName = document.createElement("td");
                tdName.textContent = item.name;

                const tdPrice = document.createElement("td");
                tdPrice.textContent = item.price;

                const tdAction = document.createElement("td");
                const delBtn = document.createElement("button");
                delBtn.textContent = "Delete";
                delBtn.classList.add("delete-btn"); // ‚Üê add this line
                delBtn.onclick = function() { deleteItem(item.id, tr); };
                tdAction.appendChild(delBtn);

                tr.appendChild(tdId);
                tr.appendChild(tdName);
                tr.appendChild(tdPrice);
                tr.appendChild(tdAction);
                tbody.appendChild(tr);
            }
    </script>

    <!-- DELETE Request -->
    <!-- Written with help from ChatGPT -->
    <script>
        window.addEventListener("load", function () {
            document.getElementById("delete-data").addEventListener("click", function () {
                const id = document.getElementById("delete-id").value.trim();

                if (!id) {
                    alert("Please enter an ID to delete");
                    return;
                }

                const xhr = new XMLHttpRequest();
                xhr.open("DELETE", `https://jdaz69h8pb.execute-api.us-east-2.amazonaws.com/items/${id}`);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.send();

                xhr.onload = function () {
                    if (xhr.status === 200) {
                        alert(`Item with ID ${id} deleted successfully!`);
                    } else {
                        alert("Error deleting item: " + xhr.statusText);
                    }
                };
            });
        });

        // Helper for delete buttons inside table
        function deleteItem(id) {
            const xhr = new XMLHttpRequest();
            xhr.open("DELETE", `https://jdaz69h8pb.execute-api.us-east-2.amazonaws.com/items/${id}`);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send();
            xhr.onload = function() {
                if (xhr.status === 200) {
                    alert(`Item ${id} deleted.`);
                }
            }
        }
    </script>
</body>

</html>
